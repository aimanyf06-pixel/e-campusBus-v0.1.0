# ðŸŽ‰ E-CAMPUSBUS NOTIFICATION SYSTEM â€” STABLE & POLISHED _Version: e-campusBus v0.1.0_

## âœ¨ Snapshot
- âœ… Real-time booking notifications (student â†’ driver) with fast polling (~5s) and live stats.
- âœ… Full driver workflow: filter by status, accept/reject with reasons, audit trail in `activity_logs`.
- âœ… Student booking UX: calendar (30 days), time picker, seat grid, driver availability, live fare summary.
- âœ… One-driver-one-bus enforcement; drivers must assign a bus before receiving notifications.
- âœ… Admin safety tools: combined reset (bookings + notifications + logs) for test data cleanup.

## ðŸ—‚ï¸ Key Files
- ðŸ“„ `driver/notifications.php` â€” Notification dashboard (cards, filters, live polling).
- ðŸ“„ `api/handle_booking_notification.php` â€” Accept/reject API with validation + logging.
- ðŸ“„ `api/check_notifications.php` â€” Lightweight polling endpoint for live updates.
- ðŸ“„ `driver/assign_bus.php` â€” Bus assignment gate to prevent â€œghost driversâ€.
- ðŸ“„ `student/make_booking.php` â€” Enhanced booking flow that triggers notifications.
- ðŸ§­ Docs: `USAGE_GUIDE.md`, `ADMIN_MAINTENANCE_GUIDE.md`, `SYSTEM_STATUS.md`, `PROJECT_STRUCTURE.md`.

## ðŸš€ Quick Start (Ops-ready)
1) Run setup tables (if belum): buka `public/setup/setup_notifications.php` â†’ pastikan `success:true`.
2) Login pelajar â†’ buat tempahan di `student/make_booking.php`.
3) Login pemandu (pastikan bas ditugaskan) â†’ semak `driver/notifications.php` â†’ terima/tolak.

## ðŸŽ¯ Whatâ€™s Working Well
- âœ”ï¸ Duplicate-safe bus management: normalized numbers, friendly errors, capacity validation, one driver per bus.
- âœ”ï¸ Fast, non-disruptive refresh: polling container + stat cards tanpa reload penuh.
- âœ”ï¸ Locked flow without bus: pemandu perlu assign bas sebelum notifikasi dibuka.
- âœ”ï¸ Auditability: setiap terima/tolak dicatat dalam `activity_logs` dengan masa/alasannya.
- âœ”ï¸ Consistent nav: pautan notifikasi ada di semua halaman pemandu; navbar pelajar diperkemas.

## ðŸ”’ Reliability & Security
- Prepared statements, input validation (booking/action), role checks on pages & API, htmlspecialchars on output.
- Booking/notification status kept in sync; rejects push booking balik ke `pending` untuk pemandu lain.
- Reset Data butang gabungan (admin) untuk lapangan ujian; elakkan guna pada produksi tanpa sandaran.

## âœ… Go-Live Checklist
- Tables wujud (`booking_notifications`, `activity_logs`) dan skema asas `i_bus_system.sql` sudah diimport.
- Pemandu ada bas ditetapkan; nombor bas unik dan kapasiti > 0.
- Student booking â†’ notifikasi muncul di papan pemuka pemandu dalam ~5s.
- Accept â†’ booking `confirmed`, notif `accepted`, `responded_at` terisi.
- Reject (dengan alasan) â†’ booking kembali `pending`, notif `rejected`, `responded_at` terisi.
- Filters (Pending/Accepted/Rejected/All) berfungsi dan statistik ikut.
- Ujian pantas lulus: login, buat tempahan, terima, tolak, dan lihat log aktiviti.

## ðŸ“Š Status
- Prod readiness: âœ… Stable
- Last updated: January 22, 2026
- Maintenance: Admin reset available; backup disyorkan sebelum operasi besar.

## ðŸ”œ Suggested Next Tweaks (opsional)
- Add email/SMS hooks if diperlukan.
- Enable sound/toast on new notification untuk pemandu.
- Tune polling interval (default 5000 ms) jika trafik tinggi/rendah.
